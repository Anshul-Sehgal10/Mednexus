(()=>{var e={};e.id=304,e.ids=[304],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},2412:e=>{"use strict";e.exports=require("assert")},4735:e=>{"use strict";e.exports=require("events")},9021:e=>{"use strict";e.exports=require("fs")},1630:e=>{"use strict";e.exports=require("http")},5591:e=>{"use strict";e.exports=require("https")},1820:e=>{"use strict";e.exports=require("os")},3873:e=>{"use strict";e.exports=require("path")},7910:e=>{"use strict";e.exports=require("stream")},6378:e=>{"use strict";e.exports=require("tty")},9551:e=>{"use strict";e.exports=require("url")},8354:e=>{"use strict";e.exports=require("util")},4075:e=>{"use strict";e.exports=require("zlib")},9544:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c});var s=r(260),a=r(8203),l=r(5155),n=r.n(l),o=r(7292),i={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>o[e]);r.d(t,i);let c=["",{children:["Emergency",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,9281)),"C:\\Users\\weabo\\Desktop\\stuff\\Mednexus\\MedNexus-master\\disease-predictor\\src\\app\\Emergency\\page.jsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,2804)),"C:\\Users\\weabo\\Desktop\\stuff\\Mednexus\\MedNexus-master\\disease-predictor\\src\\app\\layout.js"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,9116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,1485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],d=["C:\\Users\\weabo\\Desktop\\stuff\\Mednexus\\MedNexus-master\\disease-predictor\\src\\app\\Emergency\\page.jsx"],u={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/Emergency/page",pathname:"/Emergency",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},1409:(e,t,r)=>{Promise.resolve().then(r.bind(r,9281))},6838:(e,t,r)=>{Promise.resolve().then(r.bind(r,5370))},5670:(e,t,r)=>{"use strict";r.d(t,{default:()=>a.a});var s=r(6256),a=r.n(s)},6256:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a}});let s=r(5488)._(r(568));function a(e,t){var r;let a={};"function"==typeof e&&(a.loader=e);let l={...a,...t};return(0,s.default)({...l,modules:null==(r=l.loadableGenerated)?void 0:r.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},3400:(e,t)=>{"use strict";function r(e){return e.split("/").map(e=>encodeURIComponent(e)).join("/")}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"encodeURIPath",{enumerable:!0,get:function(){return r}})},5771:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return a}});let s=r(4639);function a(e){let{reason:t,children:r}=e;throw new s.BailoutToCSRError(t)}},568:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return c}});let s=r(5512),a=r(8009),l=r(5771),n=r(6054);function o(e){return{default:e&&"default"in e?e.default:e}}let i={loader:()=>Promise.resolve(o(()=>null)),loading:null,ssr:!0},c=function(e){let t={...i,...e},r=(0,a.lazy)(()=>t.loader().then(o)),c=t.loading;function d(e){let o=c?(0,s.jsx)(c,{isLoading:!0,pastDelay:!0,error:null}):null,i=!t.ssr||!!t.loading,d=i?a.Suspense:a.Fragment,u=t.ssr?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.PreloadChunks,{moduleIds:t.modules}),(0,s.jsx)(r,{...e})]}):(0,s.jsx)(l.BailoutToCSR,{reason:"next/dynamic",children:(0,s.jsx)(r,{...e})});return(0,s.jsx)(d,{...i?{fallback:o}:{},children:u})}return d.displayName="LoadableComponent",d}},6054:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return o}});let s=r(5512),a=r(5740),l=r(9294),n=r(3400);function o(e){let{moduleIds:t}=e,r=l.workAsyncStorage.getStore();if(void 0===r)return null;let o=[];if(r.reactLoadableManifest&&t){let e=r.reactLoadableManifest;for(let r of t){if(!e[r])continue;let t=e[r].files;o.push(...t)}}return 0===o.length?null:(0,s.jsx)(s.Fragment,{children:o.map(e=>{let t=r.assetPrefix+"/_next/"+(0,n.encodeURIPath)(e);return e.endsWith(".css")?(0,s.jsx)("link",{precedence:"dynamic",href:t,rel:"stylesheet",as:"style"},e):((0,a.preload)(t,{as:"script",fetchPriority:"low"}),null)})})}},5370:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v});var s=r(5512),a=r(8009),l=r(4073),n=r(4825);let o=(0,n.A)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),i=(0,n.A)("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),c=(0,n.A)("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]);var d=r(5391),u=r(5469),p=r(9469);let m=(0,n.A)("Ambulance",[["path",{d:"M10 10H6",key:"1bsnug"}],["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.28a1 1 0 0 0-.684-.948l-1.923-.641a1 1 0 0 1-.578-.502l-1.539-3.076A1 1 0 0 0 16.382 8H14",key:"lrkjwd"}],["path",{d:"M8 8v4",key:"1fwk8c"}],["path",{d:"M9 18h6",key:"x1upvd"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]),x=(0,n.A)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var h=r(7397),f=r(1579),g=r(6684);let y=({emergencyId:e,userId:t})=>{let[r,l]=(0,a.useState)([]),[n,o]=(0,a.useState)(""),[i,c]=(0,a.useState)(null),d=(0,a.useRef)(null);(0,a.useEffect)(()=>{let r=new WebSocket(`ws://localhost:3004?emergencyId=${e}&userId=${t}`);return r.onopen=()=>{console.log("WebSocket Chat Connection Established"),c(r)},r.onmessage=e=>{let t=JSON.parse(e.data);l(e=>[...e,t])},r.onerror=e=>{console.error("WebSocket Chat Error:",e)},r.onclose=()=>{console.log("WebSocket Chat Disconnected")},(async()=>{try{let t=await fetch(`http://localhost:3004/api/chat/messages/${e}`),r=await t.json();l(r)}catch(e){console.error("Error fetching previous messages:",e)}})(),()=>{r.close()}},[e,t]),(0,a.useEffect)(()=>{d.current?.scrollIntoView({behavior:"smooth"})},[r]);let u=()=>{""!==n.trim()&&i&&(i.send(JSON.stringify({senderId:t,senderType:"patient",message:n})),o(""))};return(0,s.jsxs)("div",{className:"fixed bottom-4 right-4 w-96 bg-gray-800 rounded-lg shadow-lg",children:[(0,s.jsx)("div",{className:"p-4 bg-gray-700 rounded-t-lg flex justify-between items-center",children:(0,s.jsx)("h3",{className:"font-bold",children:"Emergency Chat"})}),(0,s.jsxs)("div",{className:"h-96 overflow-y-auto p-4 space-y-3",children:[r.map((e,t)=>(0,s.jsx)("div",{className:`flex flex-col ${"doctor"===e.senderType?"items-start":"items-end"}`,children:(0,s.jsxs)("div",{className:`rounded-lg px-4 py-2 max-w-[80%] ${"doctor"===e.senderType?"bg-blue-800 text-white":"bg-blue-600 text-white"}`,children:[(0,s.jsx)("p",{children:e.message}),(0,s.jsx)("p",{className:"text-xs text-blue-200 mt-1",children:new Date(e.timestamp).toLocaleTimeString()})]})},t)),(0,s.jsx)("div",{ref:d})]}),(0,s.jsxs)("div",{className:"p-4 border-t border-gray-700 flex items-center space-x-2",children:[(0,s.jsx)(g.p,{placeholder:"Type your message...",className:"flex-1",value:n,onChange:e=>o(e.target.value),onKeyPress:e=>{"Enter"===e.key&&u()}}),(0,s.jsx)(f.$,{size:"icon",onClick:u,children:(0,s.jsx)(h.A,{className:"h-4 w-4"})})]})]})};var b=r(5668),j=r(5670);r(3245),(0,j.default)(async()=>{},{loadableGenerated:{modules:["app\\Emergency\\page.jsx -> react-leaflet"]},ssr:!1}),(0,j.default)(async()=>{},{loadableGenerated:{modules:["app\\Emergency\\page.jsx -> react-leaflet"]},ssr:!1}),(0,j.default)(async()=>{},{loadableGenerated:{modules:["app\\Emergency\\page.jsx -> react-leaflet"]},ssr:!1}),(0,j.default)(async()=>{},{loadableGenerated:{modules:["app\\Emergency\\page.jsx -> react-leaflet"]},ssr:!1}),(0,j.default)(async()=>{},{loadableGenerated:{modules:["app\\Emergency\\page.jsx -> react-leaflet"]},ssr:!1});let v=()=>{let[e,t]=(0,a.useState)(!1),[r,n]=(0,a.useState)(!1),[h,f]=(0,a.useState)(!1),[g,j]=(0,a.useState)(!1),[v,w]=(0,a.useState)(null),[N,k]=(0,a.useState)([]),[P,M]=(0,a.useState)([]),[C,E]=(0,a.useState)(""),[_,A]=(0,a.useState)(!1),[S,q]=(0,a.useState)(!1);(0,a.useEffect)(()=>{},[]),(0,a.useEffect)(()=>{},[]),(0,a.useEffect)(()=>{let e=async()=>{try{let e=await b.A.get("http://localhost:3004/api/emergency/accepted");k(e.data),console.log("Accepted emergencies:",e.data)}catch(e){console.error("Error fetching accepted emergencies:",e),alert("Failed to fetch accepted emergencies.")}};v?.role==="patient"&&e()},[v]);let I=async()=>{if(!v||!v.id){alert("Patient is not logged in.");return}j(!0),alert("Geolocation is not supported by your browser."),j(!1)};N.length>0&&N[0];let L=async(e,t)=>{try{let r=(await b.A.get("http://localhost:3004/api/directions",{params:{start:`${t.lng},${t.lat}`,end:`${e.lng},${e.lat}`}})).data.routes[0].geometry.coordinates.map(e=>[e[1],e[0]]);M(r)}catch(e){console.error("Error fetching route:",e)}};function O(e,t,r,s){let a=Math.sin(Math.PI/180*(r-e)/2)**2+Math.cos(Math.PI/180*e)*Math.cos(Math.PI/180*r)*Math.sin(Math.PI/180*(s-t)/2)**2;return 2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))*6371}(0,a.useEffect)(()=>{if(N.length>0){let e=N[0];e.patientLocation&&e.responderLocation&&L(e.patientLocation,e.responderLocation)}},[N]);let T={normal:{default:"bg-green-800/50 text-green-400",active:"bg-green-500 text-white"},moderate:{default:"bg-yellow-800/50 text-yellow-400",active:"bg-yellow-500 text-white"},critical:{default:"bg-red-800/50 text-red-400",active:"bg-red-500 text-white"}},G=async e=>{try{console.log(e),await b.A.post("http://localhost:3004/api/emergency/doctor-arrival",{emergencyId:e,status:"resolved"}),n(!0),alert("Doctor arrival confirmed. Status updated to resolved.")}catch(e){console.error("Error updating doctor arrival status:",e),alert("Failed to confirm doctor arrival.")}};return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-900 text-white flex flex-col",children:[(0,s.jsx)("div",{className:"w-full bg-black/30 backdrop-blur-md border-b border-gray-800 p-4 text-center text-lg font-bold"}),(0,s.jsxs)("div",{className:"flex flex-1 overflow-hidden mt-[1vh]",children:[(0,s.jsxs)("div",{className:"w-96 bg-black/30 backdrop-blur-md border-r border-gray-800 p-6 overflow-y-auto mt-7",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Emergency Severity"}),(0,s.jsx)("div",{className:"space-y-3",children:["normal","moderate","critical"].map(e=>(0,s.jsxs)(l.P.button,{className:`w-full py-3 rounded-lg flex items-center justify-center space-x-2 ${C===e?T[e].active:T[e].default}`,whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>E(e),children:[(0,s.jsx)(o,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:e})]},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h2",{className:"text-2xl font-bold mb-4 flex items-center",children:[(0,s.jsx)(i,{className:"w-6 h-6 mr-2 text-green-400"}),"Responding Doctor"]}),(0,s.jsx)(l.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gray-800/50 rounded-lg p-4 border border-gray-700",children:N.map(e=>(0,s.jsxs)("div",{children:[" ",(0,s.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(c,{className:"w-10 h-10 text-gray-400"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold text-lg",children:e.responderId?.name||"Responder Not Assigned"}),(0,s.jsx)("p",{className:"text-sm text-gray-400",children:e.responderId?.role||"N/A"})]})]}),(0,s.jsx)("span",{className:"text-sm text-yellow-400",children:"★"})]}),(0,s.jsxs)("div",{className:"space-y-2 text-sm text-gray-300 mt-3",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(d.A,{className:"w-4 h-4"}),(0,s.jsxs)("span",{children:[" ",O(e.patientLocation.lat,e.patientLocation.lng,e.responderLocation.lat,e.responderLocation.lng),"km away"]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(u.A,{className:"w-4 h-4"}),(0,s.jsxs)("span",{children:["Estimated Arrival:"," ",function(e,t,r=60){if(!e||!t)return"Location data missing";console.log(e,t);let s=Math.round(O(e.lat,e.lng,t.lat,t.lng)/r*60);return`${s} mins`}(e.patientLocation,e.responderLocation)]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(i,{className:"w-4 h-4"}),(0,s.jsxs)("span",{children:["LicenseNumber :"," ",e.responderId?.licenseNo||"N/A"]})]})]})]},e._id))})]})]}),(0,s.jsx)("div",{className:"flex-1 bg-gray-900 p-3 relative overflow-auto",children:(0,s.jsxs)("div",{className:"bg-black/30 backdrop-blur-md border border-gray-800 rounded-lg h-full p-4 flex flex-col relative mt-4",children:[(0,s.jsxs)("div",{className:"mb-4 flex justify-between items-center",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold",children:"Emergency Location"}),(0,s.jsx)("button",{onClick:()=>f(!h),className:"bg-blue-500 hover:bg-blue-600 p-3 rounded-full text-white flex items-center shadow-lg",children:(0,s.jsx)(p.A,{className:"w-6 h-6"})})]}),(0,s.jsx)("div",{className:"bg-gray-800/50 rounded-lg h-[calc(100%-4rem)] flex items-center justify-center",children:(0,s.jsx)("div",{className:"flex-1 p-6 overflow-y-auto",children:(0,s.jsx)("div",{className:"h-[500px] flex items-center justify-center text-gray-400",children:S?"No emergency data available":"Loading map..."})})}),(0,s.jsxs)("div",{className:"flex space-x-4 mt-auto",children:[(0,s.jsxs)(l.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"flex-1 py-4 rounded-lg text-lg font-bold bg-red-500 text-white hover:bg-red-600 disabled:bg-gray-700 flex justify-center items-center space-x-2",onClick:I,disabled:!C||e,children:[(0,s.jsx)(m,{className:"w-6 h-6"}),(0,s.jsx)("span",{children:e?"Emergency Triggered":"Trigger Emergency"})]}),N.map(e=>(0,s.jsxs)(l.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"flex-1 py-4 rounded-lg text-lg font-bold bg-green-500 text-white hover:bg-green-600 flex justify-center items-center space-x-2",onClick:()=>G(e._id),children:[(0,s.jsx)(x,{className:"w-6 h-6"}),(0,s.jsx)("span",{children:r?"Doctor Arrived":"Confirm Doctor Arrival"})]}))]})]})})]}),h&&N.length>0&&(0,s.jsx)(y,{emergencyId:N[0]._id,userId:v.id})]})}},9281:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(6760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\weabo\\\\Desktop\\\\stuff\\\\Mednexus\\\\MedNexus-master\\\\disease-predictor\\\\src\\\\app\\\\Emergency\\\\page.jsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\weabo\\Desktop\\stuff\\Mednexus\\MedNexus-master\\disease-predictor\\src\\app\\Emergency\\page.jsx","default")},3245:()=>{},5469:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(4825).A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},5391:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(4825).A)("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,913,77,668,621,988],()=>r(9544));module.exports=s})();