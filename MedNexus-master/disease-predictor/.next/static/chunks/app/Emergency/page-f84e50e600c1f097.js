(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[304],{6882:(e,t,r)=>{Promise.resolve().then(r.bind(r,6820))},6820:(e,t,r)=>{"use strict";let a,s;r.r(t),r.d(t,{default:()=>L});var n=r(5155),o=r(2115),l=r(9326),i=r(1068),c=r(4815),d=r(4673),g=r(4333),h=r(7195),m=r(37),p=r(1315),u=r(1342),x=r(9609),f=r(7370),b=r(6894);let v=e=>{let{emergencyId:t,userId:r}=e,[a,s]=(0,o.useState)([]),[l,i]=(0,o.useState)(""),[c,d]=(0,o.useState)(null),g=(0,o.useRef)(null);(0,o.useEffect)(()=>{let e=new WebSocket("ws://localhost:3004?emergencyId=".concat(t,"&userId=").concat(r));return e.onopen=()=>{console.log("WebSocket Chat Connection Established"),d(e)},e.onmessage=e=>{let t=JSON.parse(e.data);s(e=>[...e,t])},e.onerror=e=>{console.error("WebSocket Chat Error:",e)},e.onclose=()=>{console.log("WebSocket Chat Disconnected")},(async()=>{try{let e=await fetch("http://localhost:3004/api/chat/messages/".concat(t)),r=await e.json();s(r)}catch(e){console.error("Error fetching previous messages:",e)}})(),()=>{e.close()}},[t,r]),(0,o.useEffect)(()=>{var e;null===(e=g.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[a]);let h=()=>{""!==l.trim()&&c&&(c.send(JSON.stringify({senderId:r,senderType:"patient",message:l})),i(""))};return(0,n.jsxs)("div",{className:"fixed bottom-4 right-4 w-96 bg-gray-800 rounded-lg shadow-lg",children:[(0,n.jsx)("div",{className:"p-4 bg-gray-700 rounded-t-lg flex justify-between items-center",children:(0,n.jsx)("h3",{className:"font-bold",children:"Emergency Chat"})}),(0,n.jsxs)("div",{className:"h-96 overflow-y-auto p-4 space-y-3",children:[a.map((e,t)=>(0,n.jsx)("div",{className:"flex flex-col ".concat("doctor"===e.senderType?"items-start":"items-end"),children:(0,n.jsxs)("div",{className:"rounded-lg px-4 py-2 max-w-[80%] ".concat("doctor"===e.senderType?"bg-blue-800 text-white":"bg-blue-600 text-white"),children:[(0,n.jsx)("p",{children:e.message}),(0,n.jsx)("p",{className:"text-xs text-blue-200 mt-1",children:new Date(e.timestamp).toLocaleTimeString()})]})},t)),(0,n.jsx)("div",{ref:g})]}),(0,n.jsxs)("div",{className:"p-4 border-t border-gray-700 flex items-center space-x-2",children:[(0,n.jsx)(b.p,{placeholder:"Type your message...",className:"flex-1",value:l,onChange:e=>i(e.target.value),onKeyPress:e=>{"Enter"===e.key&&h()}}),(0,n.jsx)(f.$,{size:"icon",onClick:h,children:(0,n.jsx)(x.A,{className:"h-4 w-4"})})]})]})};var y=r(2651),w=r(7711);r(8413);let j=(0,w.default)(()=>r.e(219).then(r.bind(r,9219)).then(e=>e.MapContainer),{loadableGenerated:{webpack:()=>[9219]},ssr:!1}),N=(0,w.default)(()=>r.e(219).then(r.bind(r,9219)).then(e=>e.TileLayer),{loadableGenerated:{webpack:()=>[9219]},ssr:!1}),k=(0,w.default)(()=>r.e(219).then(r.bind(r,9219)).then(e=>e.Marker),{loadableGenerated:{webpack:()=>[9219]},ssr:!1}),S=(0,w.default)(()=>r.e(219).then(r.bind(r,9219)).then(e=>e.Popup),{loadableGenerated:{webpack:()=>[9219]},ssr:!1}),E=(0,w.default)(()=>r.e(219).then(r.bind(r,9219)).then(e=>e.Polyline),{loadableGenerated:{webpack:()=>[9219]},ssr:!1});{let e=r(8741);a=new e.Icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/235/235861.png",iconSize:[40,40]}),s=new e.Icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/387/387561.png",iconSize:[35,35]})}let L=()=>{let[e,t]=(0,o.useState)(!1),[x,f]=(0,o.useState)(!1),[b,w]=(0,o.useState)(!1),[L,A]=(0,o.useState)(!1),[I,C]=(0,o.useState)(null),[P,M]=(0,o.useState)([]),[_,T]=(0,o.useState)([]),[z,D]=(0,o.useState)(""),[G,O]=(0,o.useState)(!1),[R,F]=(0,o.useState)(!1);(0,o.useEffect)(()=>{{let e=r(8741);a=new e.Icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/235/235861.png",iconSize:[40,40]}),s=new e.Icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/387/387561.png",iconSize:[35,35]}),F(!0)}},[]),(0,o.useEffect)(()=>{C(JSON.parse(localStorage.getItem("user")))},[]),(0,o.useEffect)(()=>{let e=async()=>{try{let e=await y.A.get("http://localhost:3004/api/emergency/accepted");M(e.data),console.log("Accepted emergencies:",e.data)}catch(e){console.error("Error fetching accepted emergencies:",e),alert("Failed to fetch accepted emergencies.")}};(null==I?void 0:I.role)==="patient"&&e()},[I]);let H=async()=>{if(!I||!I.id){alert("Patient is not logged in.");return}if(A(!0),!navigator.geolocation){alert("Geolocation is not supported by your browser."),A(!1);return}if(!z){alert("Please select the severity of the emergency."),A(!1);return}navigator.geolocation.getCurrentPosition(async e=>{let r={lat:e.coords.latitude,lng:e.coords.longitude};try{await y.A.post("http://localhost:3004/api/emergency/trigger",{patientId:I.id,location:r,severity:z}),alert("Emergency triggered! Searching for nearby doctors..."),O(!0),t(!0)}catch(e){console.error("Error triggering emergency:",e.response?e.response.data:e.message),alert("Failed to trigger emergency.")}finally{A(!1)}},e=>{console.error("Error getting patient location:",e.message),alert("Error getting patient location: "+e.message)},{enableHighAccuracy:!0,maximumAge:0,timeout:6e4})},U=P.length>0?P[0]:null,W=async(e,t)=>{try{let r=(await y.A.get("http://localhost:3004/api/directions",{params:{start:"".concat(t.lng,",").concat(t.lat),end:"".concat(e.lng,",").concat(e.lat)}})).data.routes[0].geometry.coordinates.map(e=>[e[1],e[0]]);T(r)}catch(e){console.error("Error fetching route:",e)}};function J(e,t,r,a){let s=Math.sin(Math.PI/180*(r-e)/2)**2+Math.cos(Math.PI/180*e)*Math.cos(Math.PI/180*r)*Math.sin(Math.PI/180*(a-t)/2)**2;return 2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))*6371}(0,o.useEffect)(()=>{if(P.length>0){let e=P[0];e.patientLocation&&e.responderLocation&&W(e.patientLocation,e.responderLocation)}},[P]);let $={normal:{default:"bg-green-800/50 text-green-400",active:"bg-green-500 text-white"},moderate:{default:"bg-yellow-800/50 text-yellow-400",active:"bg-yellow-500 text-white"},critical:{default:"bg-red-800/50 text-red-400",active:"bg-red-500 text-white"}},q=async e=>{try{console.log(e),await y.A.post("http://localhost:3004/api/emergency/doctor-arrival",{emergencyId:e,status:"resolved"}),f(!0),alert("Doctor arrival confirmed. Status updated to resolved.")}catch(e){console.error("Error updating doctor arrival status:",e),alert("Failed to confirm doctor arrival.")}};return(0,n.jsxs)("div",{className:"min-h-screen bg-gray-900 text-white flex flex-col",children:[(0,n.jsx)("div",{className:"w-full bg-black/30 backdrop-blur-md border-b border-gray-800 p-4 text-center text-lg font-bold"}),(0,n.jsxs)("div",{className:"flex flex-1 overflow-hidden mt-[1vh]",children:[(0,n.jsxs)("div",{className:"w-96 bg-black/30 backdrop-blur-md border-r border-gray-800 p-6 overflow-y-auto mt-7",children:[(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Emergency Severity"}),(0,n.jsx)("div",{className:"space-y-3",children:["normal","moderate","critical"].map(e=>(0,n.jsxs)(l.P.button,{className:"w-full py-3 rounded-lg flex items-center justify-center space-x-2 ".concat(z===e?$[e].active:$[e].default),whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>D(e),children:[(0,n.jsx)(i.A,{className:"w-5 h-5"}),(0,n.jsx)("span",{children:e})]},e))})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("h2",{className:"text-2xl font-bold mb-4 flex items-center",children:[(0,n.jsx)(c.A,{className:"w-6 h-6 mr-2 text-green-400"}),"Responding Doctor"]}),(0,n.jsx)(l.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gray-800/50 rounded-lg p-4 border border-gray-700",children:P.map(e=>{var t,r,a;return(0,n.jsxs)("div",{children:[" ",(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(d.A,{className:"w-10 h-10 text-gray-400"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-semibold text-lg",children:(null===(t=e.responderId)||void 0===t?void 0:t.name)||"Responder Not Assigned"}),(0,n.jsx)("p",{className:"text-sm text-gray-400",children:(null===(r=e.responderId)||void 0===r?void 0:r.role)||"N/A"})]})]}),(0,n.jsx)("span",{className:"text-sm text-yellow-400",children:"â˜…"})]}),(0,n.jsxs)("div",{className:"space-y-2 text-sm text-gray-300 mt-3",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(g.A,{className:"w-4 h-4"}),(0,n.jsxs)("span",{children:[" ",J(e.patientLocation.lat,e.patientLocation.lng,e.responderLocation.lat,e.responderLocation.lng),"km away"]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(h.A,{className:"w-4 h-4"}),(0,n.jsxs)("span",{children:["Estimated Arrival:"," ",function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;if(!e||!t)return"Location data missing";console.log(e,t);let a=Math.round(J(e.lat,e.lng,t.lat,t.lng)/r*60);return"".concat(a," mins")}(e.patientLocation,e.responderLocation)]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(c.A,{className:"w-4 h-4"}),(0,n.jsxs)("span",{children:["LicenseNumber :"," ",(null===(a=e.responderId)||void 0===a?void 0:a.licenseNo)||"N/A"]})]})]})]},e._id)})})]})]}),(0,n.jsx)("div",{className:"flex-1 bg-gray-900 p-3 relative overflow-auto",children:(0,n.jsxs)("div",{className:"bg-black/30 backdrop-blur-md border border-gray-800 rounded-lg h-full p-4 flex flex-col relative mt-4",children:[(0,n.jsxs)("div",{className:"mb-4 flex justify-between items-center",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold",children:"Emergency Location"}),(0,n.jsx)("button",{onClick:()=>w(!b),className:"bg-blue-500 hover:bg-blue-600 p-3 rounded-full text-white flex items-center shadow-lg",children:(0,n.jsx)(m.A,{className:"w-6 h-6"})})]}),(0,n.jsx)("div",{className:"bg-gray-800/50 rounded-lg h-[calc(100%-4rem)] flex items-center justify-center",children:(0,n.jsx)("div",{className:"flex-1 p-6 overflow-y-auto",children:R&&U&&U.patientLocation?(0,n.jsxs)(j,{center:[U.patientLocation.lat,U.patientLocation.lng],zoom:20,style:{height:"500px",width:"100%"},children:[(0,n.jsx)(N,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'}),(0,n.jsx)(k,{position:[U.patientLocation.lat,U.patientLocation.lng],icon:a,children:(0,n.jsx)(S,{children:"Your Location"})}),U.responderLocation&&(0,n.jsx)(k,{position:[U.responderLocation.lat,U.responderLocation.lng],icon:s,children:(0,n.jsx)(S,{children:"Doctor is on the way!"})}),_.length>0&&(0,n.jsx)(E,{positions:_,color:"blue"})]}):(0,n.jsx)("div",{className:"h-[500px] flex items-center justify-center text-gray-400",children:R?"No emergency data available":"Loading map..."})})}),(0,n.jsxs)("div",{className:"flex space-x-4 mt-auto",children:[(0,n.jsxs)(l.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"flex-1 py-4 rounded-lg text-lg font-bold bg-red-500 text-white hover:bg-red-600 disabled:bg-gray-700 flex justify-center items-center space-x-2",onClick:H,disabled:!z||e,children:[(0,n.jsx)(p.A,{className:"w-6 h-6"}),(0,n.jsx)("span",{children:e?"Emergency Triggered":"Trigger Emergency"})]}),P.map(e=>(0,n.jsxs)(l.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"flex-1 py-4 rounded-lg text-lg font-bold bg-green-500 text-white hover:bg-green-600 flex justify-center items-center space-x-2",onClick:()=>q(e._id),children:[(0,n.jsx)(u.A,{className:"w-6 h-6"}),(0,n.jsx)("span",{children:x?"Doctor Arrived":"Confirm Doctor Arrival"})]}))]})]})})]}),b&&P.length>0&&(0,n.jsx)(v,{emergencyId:P[0]._id,userId:I.id})]})}},7370:(e,t,r)=>{"use strict";r.d(t,{$:()=>c});var a=r(5155),s=r(2115),n=r(2317),o=r(1027),l=r(7849);let i=(0,o.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:r,variant:s,size:o,asChild:c=!1,...d}=e,g=c?n.DX:"button";return(0,a.jsx)(g,{className:(0,l.cn)(i({variant:s,size:o,className:r})),ref:t,...d})});c.displayName="Button"},6894:(e,t,r)=>{"use strict";r.d(t,{p:()=>o});var a=r(5155),s=r(2115),n=r(7849);let o=s.forwardRef((e,t)=>{let{className:r,type:s,...o}=e;return(0,a.jsx)("input",{type:s,className:(0,n.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...o})});o.displayName="Input"},7849:(e,t,r)=>{"use strict";r.d(t,{cn:()=>n});var a=r(3463),s=r(9795);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[484,761,550,651,181,205,441,517,358],()=>t(6882)),_N_E=e.O()}]);