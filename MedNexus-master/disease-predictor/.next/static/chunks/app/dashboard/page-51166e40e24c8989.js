(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{347:(e,t,a)=>{Promise.resolve().then(a.bind(a,6098))},6098:(e,t,a)=>{"use strict";let s,r;a.r(t),a.d(t,{default:()=>H});var n=a(5155),l=a(2115),o=a(9326),i=a(5683),c=a(6535),d=a(8482),m=a(4333),u=a(7193),x=a(689),p=a(9329),h=a(7711);a(8413);var g=a(2651),f=a(37),b=a(9609),y=a(7370),v=a(6095),j=a(7849);let N=v.bL,w=v.l9,k=v.ZL;v.bm;let S=l.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,n.jsx)(v.hJ,{ref:t,className:(0,j.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s})});S.displayName=v.hJ.displayName;let A=l.forwardRef((e,t)=>{let{className:a,children:s,...r}=e;return(0,n.jsxs)(k,{children:[(0,n.jsx)(S,{}),(0,n.jsxs)(v.UC,{ref:t,className:(0,j.cn)("fixed left-[86%] top-[62%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...r,children:[s,(0,n.jsxs)(v.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,n.jsx)(x.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});A.displayName=v.UC.displayName;let E=e=>{let{className:t,...a}=e;return(0,n.jsx)("div",{className:(0,j.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};E.displayName="DialogHeader";let P=l.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,n.jsx)(v.hE,{ref:t,className:(0,j.cn)("text-lg font-semibold leading-none tracking-tight",a),...s})});P.displayName=v.hE.displayName,l.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,n.jsx)(v.VY,{ref:t,className:(0,j.cn)("text-sm text-muted-foreground",a),...s})}).displayName=v.VY.displayName;var I=a(6894);function L(){let[e,t]=l.useState([{text:"I am on my way. How is the patient doing?",timestamp:"10:31 AM",sender:"doctor"},{text:"The pain is still there but stable",timestamp:"10:32 AM",sender:"patient"},{text:"Keep monitoring breathing. I'm 8 minutes away.",timestamp:"10:37 AM",sender:"doctor"}]),[a,s]=l.useState(""),r=()=>{""!==a.trim()&&(t([...e,{text:a,timestamp:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),sender:"patient"}]),s(""))};return(0,n.jsxs)(N,{children:[(0,n.jsx)(w,{asChild:!0,children:(0,n.jsx)(o.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"p-2 bg-gray-800/50 rounded-lg",children:(0,n.jsx)(f.A,{className:"w-5 h-5"})})}),(0,n.jsxs)(A,{className:"sm:max-w-md",children:[(0,n.jsx)(E,{children:(0,n.jsxs)(P,{className:"flex items-center justify-between gap-2",children:[(0,n.jsx)("span",{children:"Dr. Richard Wilson"}),(0,n.jsx)("span",{className:"text-sm text-muted-foreground mr-4 text-green-600",children:"8 min away"})]})}),(0,n.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,n.jsx)("div",{className:"flex flex-col space-y-4 overflow-y-auto max-h-[60vh] p-4 bg-gradient-to-b from-blue-950 to-blue-900 rounded-lg",children:e.map((e,t)=>(0,n.jsx)("div",{className:"flex flex-col ".concat("doctor"===e.sender?"items-start":"items-end"),children:(0,n.jsxs)("div",{className:"rounded-lg px-4 py-2 max-w-[80%] ".concat("doctor"===e.sender?"bg-blue-800 text-white":"bg-blue-600 text-white"),children:[(0,n.jsx)("p",{children:e.text}),(0,n.jsx)("p",{className:"text-xs text-blue-200 mt-1",children:e.timestamp})]})},t))}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(I.p,{placeholder:"Type your message...",className:"flex-1",value:a,onChange:e=>s(e.target.value),onKeyPress:e=>{"Enter"===e.key&&r()}}),(0,n.jsx)(y.$,{size:"icon",className:"shrink-0",onClick:r,children:(0,n.jsx)(b.A,{className:"h-4 w-4"})})]})]})]})]})}let _=(0,h.default)(()=>a.e(219).then(a.bind(a,9219)).then(e=>e.MapContainer),{loadableGenerated:{webpack:()=>[9219]},ssr:!1}),z=(0,h.default)(()=>a.e(219).then(a.bind(a,9219)).then(e=>e.TileLayer),{loadableGenerated:{webpack:()=>[9219]},ssr:!1}),T=(0,h.default)(()=>a.e(219).then(a.bind(a,9219)).then(e=>e.Marker),{loadableGenerated:{webpack:()=>[9219]},ssr:!1}),C=(0,h.default)(()=>a.e(219).then(a.bind(a,9219)).then(e=>e.Popup),{loadableGenerated:{webpack:()=>[9219]},ssr:!1}),M=(0,h.default)(()=>a.e(219).then(a.bind(a,9219)).then(e=>e.Polyline),{loadableGenerated:{webpack:()=>[9219]},ssr:!1});{let e=a(8741);s=new e.Icon({iconUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png",iconSize:[25,41],iconAnchor:[12,41]}),r=new e.Icon({iconUrl:"/ca506f6caf2a9dfb39b01910e635c2fd.png",iconSize:[30,41],iconAnchor:[12,41]})}let H=()=>{let[e,t]=(0,l.useState)(null),[h,f]=(0,l.useState)([]),[b,y]=(0,l.useState)(!1),[v,j]=(0,l.useState)(null),[N,w]=(0,l.useState)(null),[k,S]=(0,l.useState)(!0),[A,E]=(0,l.useState)([]),[P,I]=(0,l.useState)(!0),[H,R]=(0,l.useState)(!1);(0,l.useEffect)(()=>{{let e=a(8741);s=new e.Icon({iconUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png",iconSize:[25,41],iconAnchor:[12,41]}),r=new e.Icon({iconUrl:"/ca506f6caf2a9dfb39b01910e635c2fd.png",iconSize:[30,41],iconAnchor:[12,41]}),R(!0)}},[]),(0,l.useEffect)(()=>{let e=localStorage.getItem("user");e&&t(JSON.parse(e)),I(!1)},[]);let D=async()=>{try{S(!k);let t=await g.A.post("http://localhost:3004/api/toggle-active",{userId:e.id});void 0!==t.data.status&&S(t.data.status)}catch(e){console.error("❌ Error toggling active status:",e)}},O=async()=>{y(!0);try{let t=await g.A.get("http://localhost:3004/api/emergency/requests"),a=t.data.some(e=>"inProgress"===e.status),s=t.data.filter(t=>{if(a)return"inProgress"===t.status;if("pending"===t.status)switch(e.role){case"doctor":return"moderate"===t.severity;case"ambulance":return"critical"===t.severity;case"nurse":return"normal"===t.severity;default:return!0}return!1});f(s),console.log("✅ Fetched emergency requests:",s)}catch(e){console.error("❌ Failed to fetch emergency requests:",e)}y(!1)},W=()=>{navigator.geolocation?navigator.geolocation.watchPosition(t=>{let{latitude:a,longitude:s}=t.coords;j({lat:a,lng:s}),console.log("✅ Location updated:",a,s),N&&N.readyState===WebSocket.OPEN&&(console.log("\uD83D\uDCE1 Sending location via WebSocket..."),N.send(JSON.stringify({responderId:e.id,lat:a,lng:s}))),h.length>0&&h.filter(e=>"accepted"===e.status).forEach(t=>{g.A.post("http://localhost:3004/api/emergency/update-location",{responderId:e.id,location:{lat:a,lng:s},emergencyId:t._id}).then(e=>{console.log("✅ Location updated for accepted emergency ".concat(t._id,":"),e.data)}).catch(e=>{console.error("❌ Error updating location for accepted emergency ".concat(t._id,":"),e.response?e.response.data:e.message)})})},e=>{console.error("❌ Geolocation error:",e),alert("Error fetching location. Please enable GPS.")},{enableHighAccuracy:!0,timeout:6e4,maximumAge:0}):alert("❌ Geolocation is not supported by this browser.")},G=async(e,t)=>{if(e&&t)try{let a=(await g.A.get("http://localhost:3004/api/directions",{params:{start:"".concat(t.lng,",").concat(t.lat),end:"".concat(e.lng,",").concat(e.lat)}})).data.routes[0].geometry.coordinates.map(e=>[e[1],e[0]]);E(a)}catch(e){console.error("Error fetching route:",e)}},U=async(t,a,s)=>{if(!(null==e?void 0:e.id)){alert("You are not logged in as a doctor.");return}if(!v){alert("Doctor's location is not available.");return}try{await g.A.post("http://localhost:3004/api/emergency/accept",{responderId:e.id,emergencyId:t,patientId:a,patientLocation:s,responderLocation:v}),alert("Emergency accepted!"),O()}catch(e){console.error("❌ Error accepting emergency:",e)}};return((0,l.useEffect)(()=>{((null==e?void 0:e.role)==="doctor"||(null==e?void 0:e.role)==="ambulance"||(null==e?void 0:e.role)==="nurse")&&O()},[e]),(0,l.useEffect)(()=>{h.length>0&&W()},[h]),(0,l.useEffect)(()=>{var e;h.length>0&&(null===(e=h[0])||void 0===e?void 0:e.patientLocation)&&v&&G(h[0].patientLocation,v)},[h,v]),(0,l.useEffect)(()=>{let e=()=>{let t=new WebSocket("ws://localhost:8081");t.onopen=()=>{console.log("Connected to WebSocket"),w(t)},t.onmessage=async e=>{console.log("\uD83D\uDCE1 WebSocket Update:",e.data);try{if(e.data instanceof Blob){let t=await e.data.text(),a=JSON.parse(t);j(a)}else{let t=JSON.parse(e.data);j(t)}}catch(e){console.error("❌ Error parsing WebSocket message:",e)}},t.onerror=e=>{console.error("❌ WebSocket Error:",e)},t.onclose=()=>{console.log("❌ WebSocket closed. Reconnecting..."),setTimeout(e,1e3)}};return e(),()=>{N&&N.close()}},[]),P)?(0,n.jsx)("div",{className:"min-h-screen bg-gray-900 text-white flex items-center justify-center",children:(0,n.jsx)("p",{children:"Loading..."})}):e?(0,n.jsxs)("div",{className:"min-h-screen bg-gray-900 text-white",children:[(0,n.jsx)("nav",{className:"fixed top-0 w-full bg-black/50 backdrop-blur-md border-b border-gray-800 z-50",children:(0,n.jsxs)("div",{className:"max-w-7xl mx-auto px-4 h-16 flex items-center justify-between",children:[(0,n.jsx)("h1",{className:"text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-gray-200 via-white to-gray-300",children:"MedNexus Dashboard"}),(0,n.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,n.jsxs)(o.P.button,{className:"px-4 py-2 rounded-full flex items-center space-x-2 ".concat(k?"bg-green-500/20 text-green-400":"bg-gray-700/20 text-gray-400"),onClick:D,whileHover:{scale:1.05},whileTap:{scale:.95},children:[k?(0,n.jsx)(c.A,{className:"w-4 h-4"}):(0,n.jsx)(d.A,{className:"w-4 h-4"}),(0,n.jsx)("span",{children:k?"Active":"Sleep Mode"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center",children:(0,n.jsx)("span",{className:"text-sm font-bold",children:"DR"})}),(0,n.jsx)("span",{className:"font-medium",children:e.name})]})]})]})}),(0,n.jsxs)("div",{className:"pt-16 flex h-screen",children:[(0,n.jsxs)("div",{className:"w-96 bg-black/30 backdrop-blur-md border-r border-gray-800 p-6 overflow-y-auto",children:[(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsxs)("h2",{className:"text-2xl font-bold mb-4",children:[e.role," Profile"]}),(0,n.jsxs)("div",{className:"space-y-2 text-gray-300",children:[(0,n.jsx)("p",{children:e.name}),(0,n.jsx)("p",{children:e.specialisation}),(0,n.jsxs)("p",{children:["Years of Experience: ",e.yearsOfExperience]}),(0,n.jsxs)("p",{children:["License Number:",e.licenseNo]}),(0,n.jsx)("div",{className:"flex space-x-4 mt-4",children:(0,n.jsxs)("div",{className:"bg-gray-800/50 rounded-lg p-3 flex-1 text-center",children:[(0,n.jsx)("p",{className:"text-sm text-gray-400",children:"Today's Patients"}),(0,n.jsx)("p",{className:"text-xl font-bold",children:h.length})]})})]})]}),(0,n.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Patient Requests"}),b?(0,n.jsx)("p",{className:"text-gray-400",children:"Loading..."}):(0,n.jsx)("div",{className:"space-y-4",children:(0,n.jsx)(i.N,{children:h.map(t=>{var a;return(0,n.jsxs)(o.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,x:-100},className:"bg-gray-800/50 rounded-lg p-4 border border-gray-700",children:[(0,n.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,n.jsx)("h3",{className:"font-semibold",children:null===(a=t.patientId)||void 0===a?void 0:a.name}),(0,n.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat("moderate"===t.severity?"bg-green-500/20 text-green-400":"critical"===t.severity?"bg-red-500/20 text-red-400":"bg-blue-500/20 text-blue-400"),children:t.severity})]}),(0,n.jsx)(L,{emergencyId:t._id,userId:e.id}),(0,n.jsxs)("div",{className:"flex items-center text-gray-400 text-sm mb-3",children:[(0,n.jsx)(m.A,{className:"w-4 h-4 mr-1"}),t.status,(0,n.jsx)("span",{className:"mx-2",children:"•"}),function(e){let t=new Date(e),a=t.getHours(),s=t.getMinutes(),r=a>=12?"PM":"AM";return a%=12,a=a||12,"".concat(a,":").concat(s<10?"0"+s:s," ").concat(r)}(t.createdAt)]}),(0,n.jsxs)("div",{className:"flex space-x-2",children:[(0,n.jsxs)(o.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"flex-1 bg-green-500/20 text-green-400 py-2 rounded-lg flex items-center justify-center space-x-1",onClick:()=>U(t._id,t.patientId._id,t.patientLocation),children:[(0,n.jsx)(u.A,{className:"w-4 h-4"}),(0,n.jsx)("span",{children:"Accept"})]}),(0,n.jsxs)(o.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"flex-1 bg-red-500/20 text-red-400 py-2 rounded-lg flex items-center justify-center space-x-1",children:[(0,n.jsx)(x.A,{className:"w-4 h-4"}),(0,n.jsx)("span",{children:"Decline"})]})]})]},t._id)})})})]}),(0,n.jsx)("div",{className:"flex-1 bg-gray-900 p-6",children:(0,n.jsxs)("div",{className:"bg-black/30 backdrop-blur-md border border-gray-800 rounded-lg h-full p-4",children:[(0,n.jsxs)("div",{className:"mb-4 flex justify-between items-center",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold",children:"Live Location Tracking"}),(0,n.jsxs)("div",{className:"flex space-x-2",children:[(0,n.jsx)(o.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"p-2 bg-gray-800/50 rounded-lg",children:(0,n.jsx)(p.A,{className:"w-7 h-5"})}),(0,n.jsx)(o.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"p-2 bg-gray-800/50 rounded-lg",children:(0,n.jsx)(L,{})})]})]}),(0,n.jsx)("div",{className:"bg-gray-800/50 rounded-lg h-[calc(100%-4rem)] flex items-center justify-center",children:(0,n.jsx)("div",{className:"flex-1 p-6 overflow-y-auto",children:H?(0,n.jsxs)(_,{center:[(null==v?void 0:v.lat)||0,(null==v?void 0:v.lng)||0],zoom:20,style:{height:"500px",width:"100%"},children:[(0,n.jsx)(z,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"\xa9 OpenStreetMap contributors"}),h.map(e=>{var t;return(0,n.jsx)(T,{position:[e.patientLocation.lat,e.patientLocation.lng],icon:s,children:(0,n.jsx)(C,{children:(null===(t=e.patientId)||void 0===t?void 0:t.name)||"Unknown Patient"})},e._id)}),v&&(0,n.jsx)(T,{position:[v.lat,v.lng],icon:r,children:(0,n.jsx)(C,{children:"Your Location"})}),A.length>0&&(0,n.jsx)(M,{positions:A,color:"blue"})]},v?"".concat(v.lat,"-").concat(v.lng):"default"):(0,n.jsx)("div",{className:"h-[500px] flex items-center justify-center text-gray-400",children:"Loading map..."})})})]})})]})]}):(0,n.jsx)("div",{className:"min-h-screen bg-gray-900 text-white flex items-center justify-center",children:(0,n.jsx)("p",{children:"Please log in to access the dashboard"})})}},7370:(e,t,a)=>{"use strict";a.d(t,{$:()=>c});var s=a(5155),r=a(2115),n=a(2317),l=a(1027),o=a(7849);let i=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=r.forwardRef((e,t)=>{let{className:a,variant:r,size:l,asChild:c=!1,...d}=e,m=c?n.DX:"button";return(0,s.jsx)(m,{className:(0,o.cn)(i({variant:r,size:l,className:a})),ref:t,...d})});c.displayName="Button"},6894:(e,t,a)=>{"use strict";a.d(t,{p:()=>l});var s=a(5155),r=a(2115),n=a(7849);let l=r.forwardRef((e,t)=>{let{className:a,type:r,...l}=e;return(0,s.jsx)("input",{type:r,className:(0,n.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...l})});l.displayName="Input"},7849:(e,t,a)=>{"use strict";a.d(t,{cn:()=>n});var s=a(3463),r=a(9795);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.QP)((0,s.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[484,761,550,651,181,797,322,441,517,358],()=>t(347)),_N_E=e.O()}]);